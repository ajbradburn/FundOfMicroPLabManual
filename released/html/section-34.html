<!DOCTYPE html>
<!--********************************************-->
<!--*       Generated from PreTeXt source      *-->
<!--*       on 2022-04-13T05:08:17-04:00       *-->
<!--*   A recent stable commit (2020-08-09):   *-->
<!--* 98f21740783f166a773df4dc83cab5293ab63a4a *-->
<!--*                                          *-->
<!--*         https://pretextbook.org          *-->
<!--*                                          *-->
<!--********************************************-->
<html lang="en-US">
<head xmlns:og="http://ogp.me/ns#" xmlns:book="https://ogp.me/ns/book#">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Connecting the Pi to Peripherials</title>
<meta name="Keywords" content="Authored in PreTeXt">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:type" content="book">
<meta property="book:title" content="An Introduction to Embedded Systems and Applications">
<meta property="book:author" content="Anthony Bradburn">
<script>window.MathJax = {
  tex: {
    inlineMath: [['\\(','\\)']],
    tags: "none",
    useLabelIds: true,
    tagSide: "right",
    tagIndent: ".8em",
    packages: {'[+]': ['base', 'extpfeil', 'ams', 'amscd', 'newcommand', 'knowl']}
  },
  options: {
    ignoreHtmlClass: "tex2jax_ignore|ignore-math",
    processHtmlClass: "process-math",
  },
  chtml: {
    scale: 0.88,
    mtextInheritFont: true
  },
  loader: {
    load: ['input/asciimath', '[tex]/extpfeil', '[tex]/amscd', '[tex]/newcommand', '[pretext]/mathjaxknowl3.js'],
    paths: {pretext: "https://pretextbook.org/js/lib"},
  },
};
</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><link href="https://unpkg.com/prismjs@v1.22.0/themes/prism.css" rel="stylesheet">
<script src="https://pretextbook.org/js/lib/jquery.min.js"></script><script src="https://pretextbook.org/js/lib/jquery.sticky.js"></script><script src="https://pretextbook.org/js/lib/jquery.espy.min.js"></script><script src="https://pretextbook.org/js/0.13/pretext.js"></script><script>miniversion=0.674</script><script src="https://pretextbook.org/js/0.13/pretext_add_on.js?x=1"></script><script src="https://pretextbook.org/js/lib/knowl.js"></script><!--knowl.js code controls Sage Cells within knowls--><script>sagecellEvalName='Evaluate (Sage)';
</script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600,600italic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/pretext.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/pretext_add_on.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/banner_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/toc_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/knowls_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/style_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/colors_blue_red.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/setcolors.css" rel="stylesheet" type="text/css">
<!-- 2019-10-12: Temporary - CSS file for experiments with styling --><link href="developer.css" rel="stylesheet" type="text/css">
</head>
<body class="pretext-book ignore-math has-toc has-sidebar-left">
<a class="assistive" href="#content">Skip to main content</a><div id="latex-macros" class="hidden-content process-math" style="display:none"><span class="process-math">\(\newcommand{\N}{\mathbb N}
\newcommand{\Z}{\mathbb Z}
\newcommand{\Q}{\mathbb Q}
\newcommand{\R}{\mathbb R}
\newcommand{\lt}{&lt;}
\newcommand{\gt}{&gt;}
\newcommand{\amp}{&amp;}
\)</span></div>
<header id="masthead" class="smallbuttons"><div class="banner"><div class="container">
<a id="logo-link" href=""></a><div class="title-container">
<h1 class="heading"><a href="my-great-book.html"><span class="title">An Introduction to Embedded Systems and Applications:</span> <span class="subtitle">Through the Raspberry Pi</span></a></h1>
<p class="byline">Anthony Bradburn</p>
</div>
</div></div>
<nav id="primary-navbar" class="navbar"><div class="container">
<div class="navbar-top-buttons">
<button class="sidebar-left-toggle-button button active" aria-label="Show or hide table of contents sidebar">Contents</button><div class="tree-nav toolbar toolbar-divisor-3"><span class="threebuttons"><a id="previousbutton" class="previous-button toolbar-item button" href="section-33.html" title="Previous">Prev</a><a id="upbutton" class="up-button button toolbar-item" href="ch-first.html" title="Up">Up</a><a id="nextbutton" class="next-button button toolbar-item" href="section-35.html" title="Next">Next</a></span></div>
</div>
<div class="navbar-bottom-buttons toolbar toolbar-divisor-4">
<button class="sidebar-left-toggle-button button toolbar-item active">Contents</button><a class="previous-button toolbar-item button" href="section-33.html" title="Previous">Prev</a><a class="up-button button toolbar-item" href="ch-first.html" title="Up">Up</a><a class="next-button button toolbar-item" href="section-35.html" title="Next">Next</a>
</div>
</div></nav></header><div class="page">
<div id="sidebar-left" class="sidebar" role="navigation"><div class="sidebar-content">
<nav id="toc"><ul>
<li class="link frontmatter">
<a href="frontmatter.html" data-scroll="frontmatter" class="internal"><span class="title">Front Matter</span></a><ul>
<li><a href="colophon-1.html" data-scroll="colophon-1" class="internal">Colophon</a></li>
<li><a href="preface.html" data-scroll="preface" class="internal">Feedback about the text</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">1</span> <span class="title">Setting up for, and exploring assembly programming.</span></a><ul>
<li><a href="section-1.html" data-scroll="section-1" class="internal">Installing Code::Blocks IDE in Raspberry Pi OS</a></li>
<li><a href="section-2.html" data-scroll="section-2" class="internal">Writing and Debugging Programs</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">2</span> <span class="title">Basics of Programming</span></a><ul>
<li><a href="section-3.html" data-scroll="section-3" class="internal">Where to begin?</a></li>
<li><a href="section-4.html" data-scroll="section-4" class="internal">Defining the problem.</a></li>
<li><a href="section-5.html" data-scroll="section-5" class="internal">Framing the Solution.</a></li>
<li><a href="section-6.html" data-scroll="section-6" class="internal">Documenting the process.</a></li>
<li><a href="section-7.html" data-scroll="section-7" class="internal">Writing Code</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">3</span> <span class="title">Basics of Assembly</span></a><ul>
<li><a href="section-8.html" data-scroll="section-8" class="internal">Associated Reading</a></li>
<li><a href="section-9.html" data-scroll="section-9" class="internal">Basic Operations and Composition</a></li>
<li><a href="section-10.html" data-scroll="section-10" class="internal">Memory Addressing</a></li>
<li><a href="section-11.html" data-scroll="section-11" class="internal">Arithmetic Functions</a></li>
<li><a href="section-12.html" data-scroll="section-12" class="internal">Logical Operations</a></li>
<li><a href="section-13.html" data-scroll="section-13" class="internal">C</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">4</span> <span class="title">Assembly Control Structures</span></a><ul>
<li><a href="section-14.html" data-scroll="section-14" class="internal">Associated Reading</a></li>
<li><a href="section-15.html" data-scroll="section-15" class="internal">Loops</a></li>
<li><a href="section-16.html" data-scroll="section-16" class="internal">Branching</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">5</span> <span class="title">High-level Programming Languages</span></a><ul>
<li><a href="section-17.html" data-scroll="section-17" class="internal">Associated Reading</a></li>
<li><a href="section-18.html" data-scroll="section-18" class="internal">High Level Programming Languages</a></li>
<li><a href="section-19.html" data-scroll="section-19" class="internal">Libraries</a></li>
<li><a href="section-20.html" data-scroll="section-20" class="internal">Functions</a></li>
<li><a href="section-21.html" data-scroll="section-21" class="internal">Variables</a></li>
<li><a href="section-22.html" data-scroll="section-22" class="internal">Control Structures</a></li>
<li><a href="section-23.html" data-scroll="section-23" class="internal">Structure</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">6</span> <span class="title">Setting up for, and exploring python programming.</span></a><ul>
<li><a href="section-24.html" data-scroll="section-24" class="internal">Raspi Config</a></li>
<li><a href="section-25.html" data-scroll="section-25" class="internal">Installing Python Libraries</a></li>
<li><a href="section-26.html" data-scroll="section-26" class="internal">The Thonny Python IDE</a></li>
<li><a href="section-27.html" data-scroll="section-27" class="internal">Debugging with Python</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">7</span> <span class="title">Python Basics</span></a><ul>
<li><a href="section-28.html" data-scroll="section-28" class="internal">Associated Reading</a></li>
<li><a href="section-29.html" data-scroll="section-29" class="internal">Basic Python Programs</a></li>
<li><a href="section-30.html" data-scroll="section-30" class="internal">Data Types</a></li>
<li><a href="section-31.html" data-scroll="section-31" class="internal">Checking User Input</a></li>
<li><a href="section-32.html" data-scroll="section-32" class="internal">Providing Output</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">8</span> <span class="title">Interfacing Basics</span></a><ul>
<li><a href="section-33.html" data-scroll="section-33" class="internal">Associated Reading</a></li>
<li><a href="section-34.html" data-scroll="section-34" class="active">Connecting the Pi to Peripherials</a></li>
<li><a href="section-35.html" data-scroll="section-35" class="internal">Troubleshooting</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">9</span> <span class="title">Interfacing with increased versatility, and complexity.</span></a><ul>
<li><a href="section-36.html" data-scroll="section-36" class="internal">Associated Reading</a></li>
<li><a href="section-37.html" data-scroll="section-37" class="internal">Connecting Using Data Exchange Protocols</a></li>
<li><a href="section-38.html" data-scroll="section-38" class="internal">Reading and Using Data</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">10</span> <span class="title">Data Management</span></a><ul>
<li><a href="section-39.html" data-scroll="section-39" class="internal">Associated Reading</a></li>
<li><a href="section-40.html" data-scroll="section-40" class="internal">Connecting to the Internet</a></li>
</ul>
</li>
<li class="link backmatter"><a href="backmatter.html" data-scroll="backmatter" class="internal"><span class="title">Backmatter</span></a></li>
<li class="link">
<a href="appendix-1.html" data-scroll="appendix-1" class="internal"><span class="codenumber">A</span> <span class="title">References</span></a><ul><li><a href="references-section.html" data-scroll="references-section" class="internal">References</a></li></ul>
</li>
<li class="link">
<a href="appendix-2.html" data-scroll="appendix-2" class="internal"><span class="codenumber">B</span> <span class="title">Sourcing Suggestions</span></a><ul>
<li><a href="section-41.html" data-scroll="section-41" class="internal">Raspberry Pi</a></li>
<li><a href="section-42.html" data-scroll="section-42" class="internal">Sensors and Misc Components</a></li>
</ul>
</li>
<li class="link">
<a href="appendix-3.html" data-scroll="appendix-3" class="internal"><span class="codenumber">C</span> <span class="title">Using Pretext</span></a><ul>
<li><a href="section-43.html" data-scroll="section-43" class="internal">Editing and Building Custom Versions</a></li>
<li><a href="section-44.html" data-scroll="section-44" class="internal">Using PreTeXt CLI</a></li>
</ul>
</li>
<li class="link"><a href="colophon-2.html" data-scroll="colophon-2" class="internal"><span class="title">Colophon</span></a></li>
</ul></nav><div class="extras"><nav><a class="pretext-link" href="https://pretextbook.org">Authored in PreTeXt</a><a href="https://www.mathjax.org"><img title="Powered by MathJax" src="https://www.mathjax.org/badge/badge.gif" alt="Powered by MathJax"></a></nav></div>
</div></div>
<main class="main"><div id="content" class="pretext-content">
<section class="section" id="section-34"><h2 class="heading hide-type">
<span class="type">Section</span> <span class="codenumber">8.2</span> <span class="title">Connecting the Pi to Peripherials</span>
</h2>
<section class="subsection" id="subsection-76"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">8.2.1</span> <span class="title">Discussion</span>
</h3>
<p id="p-267">Before we can start programming, and seeing the fruits of our labor on something other than a computer screen, it is necessary to attach our Raspberry Pi to peripherals. As you know, when working with electronics, you have to be aware of the power limitations of the components you're working with. You have to design your circuits with this in mind.</p>
<p id="p-268">While the circuitry of this lab isn't complicated, doing something incorrectly can result in damage to your Raspberry Pi. It is recommended that you check, and double check your work before powering up your Raspberry Pi.</p>
<p id="p-269">If you do any of your own design, make sure that you read up on the voltage, and current limits for each of the Raspberry Pi GPIO pins. Allowing too much current or voltage can easily cause damage.</p></section><section class="subsection" id="subsection-77"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">8.2.2</span> <span class="title">Required Equipment</span>
</h3>
<p id="p-270">These are the required components.</p>
<figure class="table table-like" id="table-2"><figcaption><span class="type">Table</span><span class="space"> </span><span class="codenumber">8.2.1<span class="period">.</span></span><span class="space"> </span></figcaption><div class="tabular-box natural-width"><table class="tabular">
<tr>
<td class="l m b0 r0 l0 t0 lines">Amount</td>
<td class="l m b0 r0 l0 t0 lines">Part Type</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">1</td>
<td class="l m b0 r0 l0 t0 lines">Breadboard</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">1</td>
<td class="l m b0 r0 l0 t0 lines">100nF Capacitor</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">6</td>
<td class="l m b0 r0 l0 t0 lines">Red LED</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">6</td>
<td class="l m b0 r0 l0 t0 lines">470Ω Resistor</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">1</td>
<td class="l m b0 r0 l0 t0 lines">10KΩ Resistor</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">1</td>
<td class="l m b0 r0 l0 t0 lines">Raspberry Pi 3</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">1</td>
<td class="l m b0 r0 l0 t0 lines">Push button</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">Handful</td>
<td class="l m b0 r0 l0 t0 lines">Male to Female Jumper Wires</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">Handful</td>
<td class="l m b0 r0 l0 t0 lines">Solid Core Jumper Wires</td>
</tr>
</table></div></figure></section><section class="subsection" id="subsection-78"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">8.2.3</span> <span class="title">Preview</span>
</h3>
<p id="p-271">Our objective is to create a dice rolling circuit. We will provide user input through a momentary switch, and we will get output through LEDs. Our little computer will run a program that responds to a button push, generates a random number between 1 and 6, and then displays the value generated by illuminating a corresponding number of LEDs.</p>
<p id="p-272">I recommend that care be taken with the placement of the components, as the following lab will build upon this initial setup. Setting it up correctly the first time will save you the trouble of rebuilding things.</p>
<p id="p-273">This is what we are aiming for:</p>
<figure class="figure figure-like" id="figure-42"><div class="image-box" style="width: 100%; margin-left: 0%; margin-right: 0%;"><img src="external/photographs/interfacing_basics_bb.jpg" class="contained" alt="A Raspberry Pi 3 with GPIO pins connected to an array of LEDs and a momentary switch."></div>
<figcaption><span class="type">Figure</span><span class="space"> </span><span class="codenumber">8.2.2<span class="period">.</span></span><span class="space"> </span>The Completed Circuit</figcaption></figure><figure class="figure figure-like" id="figure-43"><div class="image-box" style="width: 100%; margin-left: 0%; margin-right: 0%;"><img src="external/generated/interfacing_basics_bb.svg" role="img" class="contained" alt="A Raspberry Pi 3 with GPIO pins connected to an array of LEDs and a momentary switch."></div>
<figcaption><span class="type">Figure</span><span class="space"> </span><span class="codenumber">8.2.3<span class="period">.</span></span><span class="space"> </span>The Completed Circuit</figcaption></figure></section><section class="subsection" id="subsection-79"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">8.2.4</span> <span class="title">Wiring</span>
</h3>
<figure class="figure figure-like" id="figure-44"><div class="image-box" style="width: 100%; margin-left: 0%; margin-right: 0%;"><img src="external/generated/interfacing_basics_img01.svg" role="img" class="contained" alt="A Raspberry Pi 3 with GPIO pins connected to an array of LEDs and a momentary switch."></div>
<figcaption><span class="type">Figure</span><span class="space"> </span><span class="codenumber">8.2.4<span class="period">.</span></span><span class="space"> </span>Circuit Schematic for Momentary Switch</figcaption></figure><figure class="figure figure-like" id="figure-45"><div class="image-box" style="width: 100%; margin-left: 0%; margin-right: 0%;"><img src="external/generated/interfacing_basics_img02.svg" role="img" class="contained" alt="A Raspberry Pi 3 with GPIO pins connected to an array of LEDs and a momentary switch."></div>
<figcaption><span class="type">Figure</span><span class="space"> </span><span class="codenumber">8.2.5<span class="period">.</span></span><span class="space"> </span>Circuit Schematic for LEDs</figcaption></figure></section><section class="subsection" id="subsection-80"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">8.2.5</span> <span class="title">Raspberry Pi GPIO Connections</span>
</h3>
<p id="p-274">In order to match the code that will follow, special care will be needed with matching the correct GPIO to the proper components.</p>
<figure class="figure figure-like" id="figure-46"><div class="image-box" style="width: 100%; margin-left: 0%; margin-right: 0%;"><img src="external/images/gpiopinsv3withpi.svg" role="img" class="contained" alt="The GPIO pinout for the Raspberry Pi 3."></div>
<figcaption><span class="type">Figure</span><span class="space"> </span><span class="codenumber">8.2.6<span class="period">.</span></span><span class="space"> </span>Raspberry Pi 3 GPIO Pinout</figcaption></figure><figure class="table table-like" id="table-3"><figcaption><span class="type">Table</span><span class="space"> </span><span class="codenumber">8.2.7<span class="period">.</span></span><span class="space"> </span></figcaption><div class="tabular-box natural-width"><table class="tabular">
<tr>
<td class="l m b0 r0 l0 t0 lines">GPIO Designation</td>
<td class="l m b0 r0 l0 t0 lines">Header Pin</td>
<td class="l m b0 r0 l0 t0 lines">Component</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">GND</td>
<td class="l m b0 r0 l0 t0 lines">Pin 9</td>
<td class="l m b0 r0 l0 t0 lines">GND (Shared)</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">GPIO25</td>
<td class="l m b0 r0 l0 t0 lines">Pin 22</td>
<td class="l m b0 r0 l0 t0 lines">Switch</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">GPIO13</td>
<td class="l m b0 r0 l0 t0 lines">Pin 33</td>
<td class="l m b0 r0 l0 t0 lines">LED 1</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">GPIO16</td>
<td class="l m b0 r0 l0 t0 lines">Pin 36</td>
<td class="l m b0 r0 l0 t0 lines">LED 2</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">GPIO19</td>
<td class="l m b0 r0 l0 t0 lines">Pin 35</td>
<td class="l m b0 r0 l0 t0 lines">LED 3</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">GPIO20</td>
<td class="l m b0 r0 l0 t0 lines">Pin 38</td>
<td class="l m b0 r0 l0 t0 lines">LED 4</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">GPIO26</td>
<td class="l m b0 r0 l0 t0 lines">Pin 37</td>
<td class="l m b0 r0 l0 t0 lines">LED 5</td>
</tr>
<tr>
<td class="l m b0 r0 l0 t0 lines">GPIO21</td>
<td class="l m b0 r0 l0 t0 lines">Pin 40</td>
<td class="l m b0 r0 l0 t0 lines">LED 6</td>
</tr>
</table></div></figure></section><section class="subsection" id="subsection-81"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">8.2.6</span> <span class="title"></span>
</h3>
<p id="p-275">Using the schematics, and details provided, wire up the components to the Raspberry Pi. When done, boot it up, and proceed to the next section.</p></section><section class="subsection" id="subsection-82"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">8.2.7</span> <span class="title">Code</span>
</h3>
<p id="p-276">With everything wired up, transcribe the following program, and run it.</p>
<p id="p-277"><a class="external" href="https://raw.githubusercontent.com/ajbradburn/IntroToEmbeddedSystemsLabExercises/master/interfacing_basics/dice.py" target="_blank">Download the Source</a><a href="" data-knowl="" class="id-ref fn-knowl original" data-refid="hk-fn-31" id="fn-31"><sup> 31 </sup></a></p>
<figure class="listing figure-like" id="listing-36"><div class="code-box" style="width: 100%; margin-left: 0%; margin-right: 0%;"><pre class="program"><code class="language-none"> 1|  import signal
 2|  import sys
 3|  import RPi.GPIO as GPIO
 4|  from time import sleep
 5|  import random
 6|
 7|  # Define a class to handle displaying a number on the LED array.
 8|  class led_display:
 9|    # Define LED pins. There are a number of ways to do this
10|    # I am doing it this way because I want it to be readable, and meaningful.
11|    lp1 = 13 # pin for LED 1
12|    lp2 = 16
13|    lp3 = 19
14|    lp4 = 20
15|    lp5 = 26
16|    lp6 = 21
17|    lp = [lp1, lp2, lp3, lp4, lp5, lp6] # An array of all LED pins in LED order.
18|
19|    # Class constructor function.
20|    # Initialize essential settings.
21|    def __init__(self):
22|      GPIO.setmode(GPIO.BCM)
23|      for l in self.lp:
24|        GPIO.setup(l, GPIO.OUT)
25|
26|    # Class Destructor function.
27|    # Do things that should be done with stopping.
28|    def __del__(self):
29|      GPIO.cleanup()
30|      return
31|
32|    # Display function: Illuminate n LEDs based upon a number provided.
33|    def display(self, number):
34|      if number &lt; 0:
35|        return False
36|
37|      for i in range(0, len(self.lp)):
38|        n = i + 1
39|        if n &lt;= number:
40|          GPIO.output(self.lp[i], 1)
41|        else:
42|          GPIO.output(self.lp[i], 0)
43|
</code></pre></div>
<figcaption><span class="type">Listing</span><span class="space"> </span><span class="codenumber">8.2.8<span class="period">.</span></span><span class="space"> </span></figcaption></figure><figure class="listing figure-like" id="listing-37"><div class="code-box" style="width: 100%; margin-left: 0%; margin-right: 0%;"><pre class="program"><code class="language-none">44|    # An animation to indicate something is happening.
45|    def interlude(self):
46|      # Clear all of the LEDs quickly.
47|      for l in self.lp:
48|        GPIO.output(l, 0)
49|      sleep(0.100)
50|      # Turn on each LED with a small pause between each.
51|      for l in self.lp:
52|        GPIO.output(l, 1)
53|        sleep(0.020)
54|      # Turn off each LED with a small pause between each.
55|      for l in self.lp:
56|        GPIO.output(l, 0)
57|        sleep(0.020)
58|
59|  button_pin = 25
60|
61|  # Upon Ctrl-C, exit the application.
62|  def signal_handler(sig, frame):
63|    global led_display
64|    del led_display
65|    sys.exit(0)
66|
67|  def roll_dice(channel):
68|    led_display.interlude()
69|    roll = random.randint(1, 6)
70|    led_display.display(roll)
71|    print("New roll of: {}.".format(roll))
72|
73|  # Start monitoring for, and responding to, a button press.
74|  def start(button_pin, led_display):
75|    GPIO.setup(button_pin, GPIO.IN, pull_up_down=GPIO.PUD_UP)
76|    # Monitor the button pin, and when it is pressed for 100ms, call the function roll_dice.
77|    GPIO.add_event_detect(button_pin, GPIO.FALLING, callback=roll_dice, bouncetime=100)
78|    signal.signal(signal.SIGINT, signal_handler)
79|    signal.pause()
80|
81|  led_display = led_display()
82|  start(button_pin, led_display)
</code></pre></div>
<figcaption><span class="type">Listing</span><span class="space"> </span><span class="codenumber">8.2.9<span class="period">.</span></span><span class="space"> </span></figcaption></figure><p id="p-278">This program, unlike the rest we've done so far, will not end until you stop it manually. While it is running, you can press the button on the bread board, and then view the numerical output.</p></section><section class="subsection" id="subsection-83"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">8.2.8</span> <span class="title">Exploration</span>
</h3>
<p id="p-279">The <code class="code-inline tex2jax_ignore">RPi.GPIO</code> library offers two different ways to refer to the pins that you want to use. The <code class="code-inline tex2jax_ignore">GPIO.BCM</code> mode that is used in our example program on line 22 sets up the program to use the pins as they are known by the Broadcom chip on the Raspberry Pi. The other option, <code class="code-inline tex2jax_ignore">GPIO.BOARD</code> allows you to refer to the pins by their header number. In a later experiment, we will make use of some more advanced features that require the <code class="code-inline tex2jax_ignore">GPIO.BCM</code> mode. For that reason, we are using it here.</p>
<p id="p-280">Next, on line 17, you'll observe that we created a list that contains all 6 pin numbers attached to our LEDs. On line 23, we use a for loop to iterate over that list, and call <code class="code-inline tex2jax_ignore">GPIO.setup([pin number], GPIO.OUT)</code>. This function configures the pin to operate in output mode. When your intent is to control something with the pin, output mode is what you want. However, if you're looking to read a value, or detect a button press, input mode is needed.</p>
<p id="p-281">On line 75, we use the <code class="code-inline tex2jax_ignore">GPIO.setup()</code> function again, but for the button. In this case we use the input mode, and add a parameter that also configures a pull-up resistor. If you're not familiar with it, a pull-up resistor is a high value resistor connected to a voltage source and causes the signal line to rest at the high value instead of floating when not used. The alternative is a pull-down resistor which is just a high value resistor connected to GND and causes the line to stay at a low value when not used.</p>
<p id="p-282">There are a number of possible approaches to determining when the button is pressed, but the most reliable way will generally always be one that relies upon hardware interrupts. On line 77, we make use of the <code class="code-inline tex2jax_ignore">GPIO.add_event_detect()</code> function to monitor the button pin for a transition from high to low. When that happens, the function <code class="code-inline tex2jax_ignore">roll_dice</code> will be called.</p>
<p id="p-283">Upon being called, the <code class="code-inline tex2jax_ignore">roll_dice</code> function will roll a random number, and display the number on the LED display we've created.</p></section></section><div class="hidden-content tex2jax_ignore" id="hk-fn-31"><div class="fn"><code class="code-inline tex2jax_ignore">https://raw.githubusercontent.com/ajbradburn/IntroToEmbeddedSystemsLabExercises/master/interfacing_basics/dice.py</code></div></div>
</div></main>
</div>
<script src="https://unpkg.com/prismjs@v1.22.0/components/prism-core.min.js"></script><script src="https://unpkg.com/prismjs@v1.22.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>

<!DOCTYPE html>
<!--********************************************-->
<!--*       Generated from PreTeXt source      *-->
<!--*       on 2022-04-12T09:19:01-04:00       *-->
<!--*   A recent stable commit (2020-08-09):   *-->
<!--* 98f21740783f166a773df4dc83cab5293ab63a4a *-->
<!--*                                          *-->
<!--*         https://pretextbook.org          *-->
<!--*                                          *-->
<!--********************************************-->
<html lang="en-US">
<head xmlns:og="http://ogp.me/ns#" xmlns:book="https://ogp.me/ns/book#">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Loops</title>
<meta name="Keywords" content="Authored in PreTeXt">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:type" content="book">
<meta property="book:title" content="An Introduction to Embedded Systems and Applications">
<meta property="book:author" content="Anthony Bradburn">
<script>window.MathJax = {
  tex: {
    inlineMath: [['\\(','\\)']],
    tags: "none",
    useLabelIds: true,
    tagSide: "right",
    tagIndent: ".8em",
    packages: {'[+]': ['base', 'extpfeil', 'ams', 'amscd', 'newcommand', 'knowl']}
  },
  options: {
    ignoreHtmlClass: "tex2jax_ignore|ignore-math",
    processHtmlClass: "process-math",
  },
  chtml: {
    scale: 0.88,
    mtextInheritFont: true
  },
  loader: {
    load: ['input/asciimath', '[tex]/extpfeil', '[tex]/amscd', '[tex]/newcommand', '[pretext]/mathjaxknowl3.js'],
    paths: {pretext: "https://pretextbook.org/js/lib"},
  },
};
</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><link href="https://unpkg.com/prismjs@v1.22.0/themes/prism.css" rel="stylesheet">
<script src="https://pretextbook.org/js/lib/jquery.min.js"></script><script src="https://pretextbook.org/js/lib/jquery.sticky.js"></script><script src="https://pretextbook.org/js/lib/jquery.espy.min.js"></script><script src="https://pretextbook.org/js/0.13/pretext.js"></script><script>miniversion=0.674</script><script src="https://pretextbook.org/js/0.13/pretext_add_on.js?x=1"></script><script src="https://pretextbook.org/js/lib/knowl.js"></script><!--knowl.js code controls Sage Cells within knowls--><script>sagecellEvalName='Evaluate (Sage)';
</script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600,600italic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/pretext.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/pretext_add_on.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/banner_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/toc_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/knowls_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/style_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/colors_blue_red.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/setcolors.css" rel="stylesheet" type="text/css">
<!-- 2019-10-12: Temporary - CSS file for experiments with styling --><link href="developer.css" rel="stylesheet" type="text/css">
</head>
<body class="pretext-book ignore-math has-toc has-sidebar-left">
<a class="assistive" href="#content">Skip to main content</a><div id="latex-macros" class="hidden-content process-math" style="display:none"><span class="process-math">\(\newcommand{\N}{\mathbb N}
\newcommand{\Z}{\mathbb Z}
\newcommand{\Q}{\mathbb Q}
\newcommand{\R}{\mathbb R}
\newcommand{\lt}{&lt;}
\newcommand{\gt}{&gt;}
\newcommand{\amp}{&amp;}
\)</span></div>
<header id="masthead" class="smallbuttons"><div class="banner"><div class="container">
<a id="logo-link" href=""></a><div class="title-container">
<h1 class="heading"><a href="my-great-book.html"><span class="title">An Introduction to Embedded Systems and Applications:</span> <span class="subtitle">Through the Raspberry Pi</span></a></h1>
<p class="byline">Anthony Bradburn</p>
</div>
</div></div>
<nav id="primary-navbar" class="navbar"><div class="container">
<div class="navbar-top-buttons">
<button class="sidebar-left-toggle-button button active" aria-label="Show or hide table of contents sidebar">Contents</button><div class="tree-nav toolbar toolbar-divisor-3"><span class="threebuttons"><a id="previousbutton" class="previous-button toolbar-item button" href="section-14.html" title="Previous">Prev</a><a id="upbutton" class="up-button button toolbar-item" href="ch-first.html" title="Up">Up</a><a id="nextbutton" class="next-button button toolbar-item" href="section-16.html" title="Next">Next</a></span></div>
</div>
<div class="navbar-bottom-buttons toolbar toolbar-divisor-4">
<button class="sidebar-left-toggle-button button toolbar-item active">Contents</button><a class="previous-button toolbar-item button" href="section-14.html" title="Previous">Prev</a><a class="up-button button toolbar-item" href="ch-first.html" title="Up">Up</a><a class="next-button button toolbar-item" href="section-16.html" title="Next">Next</a>
</div>
</div></nav></header><div class="page">
<div id="sidebar-left" class="sidebar" role="navigation"><div class="sidebar-content">
<nav id="toc"><ul>
<li class="link frontmatter">
<a href="frontmatter.html" data-scroll="frontmatter" class="internal"><span class="title">Front Matter</span></a><ul>
<li><a href="colophon-1.html" data-scroll="colophon-1" class="internal">Colophon</a></li>
<li><a href="preface.html" data-scroll="preface" class="internal">Feedback about the text</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">1</span> <span class="title">Setting up for, and exploring assembly programming.</span></a><ul>
<li><a href="section-1.html" data-scroll="section-1" class="internal">Installing Code::Blocks IDE in Raspberry Pi OS</a></li>
<li><a href="section-2.html" data-scroll="section-2" class="internal">Writing and Debugging Programs</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">2</span> <span class="title">Basics of Programming</span></a><ul>
<li><a href="section-3.html" data-scroll="section-3" class="internal">Where to begin?</a></li>
<li><a href="section-4.html" data-scroll="section-4" class="internal">Defining the problem.</a></li>
<li><a href="section-5.html" data-scroll="section-5" class="internal">Framing the Solution.</a></li>
<li><a href="section-6.html" data-scroll="section-6" class="internal">Documenting the process.</a></li>
<li><a href="section-7.html" data-scroll="section-7" class="internal">Writing Code</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">3</span> <span class="title">Basics of Assembly</span></a><ul>
<li><a href="section-8.html" data-scroll="section-8" class="internal">Associated Reading</a></li>
<li><a href="section-9.html" data-scroll="section-9" class="internal">Basic Operations and Composition</a></li>
<li><a href="section-10.html" data-scroll="section-10" class="internal">Memory Addressing</a></li>
<li><a href="section-11.html" data-scroll="section-11" class="internal">Arithmetic Functions</a></li>
<li><a href="section-12.html" data-scroll="section-12" class="internal">Logical Operations</a></li>
<li><a href="section-13.html" data-scroll="section-13" class="internal">C</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">4</span> <span class="title">Assembly Control Structures</span></a><ul>
<li><a href="section-14.html" data-scroll="section-14" class="internal">Associated Reading</a></li>
<li><a href="section-15.html" data-scroll="section-15" class="active">Loops</a></li>
<li><a href="section-16.html" data-scroll="section-16" class="internal">Branching</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">5</span> <span class="title">High-level Programming Languages</span></a><ul>
<li><a href="section-17.html" data-scroll="section-17" class="internal">Associated Reading</a></li>
<li><a href="section-18.html" data-scroll="section-18" class="internal">High Level Programming Languages</a></li>
<li><a href="section-19.html" data-scroll="section-19" class="internal">Libraries</a></li>
<li><a href="section-20.html" data-scroll="section-20" class="internal">Functions</a></li>
<li><a href="section-21.html" data-scroll="section-21" class="internal">Variables</a></li>
<li><a href="section-22.html" data-scroll="section-22" class="internal">Control Structures</a></li>
<li><a href="section-23.html" data-scroll="section-23" class="internal">Structure</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">6</span> <span class="title">Setting up for, and exploring python programming.</span></a><ul>
<li><a href="section-24.html" data-scroll="section-24" class="internal">Raspi Config</a></li>
<li><a href="section-25.html" data-scroll="section-25" class="internal">Installing Python Libraries</a></li>
<li><a href="section-26.html" data-scroll="section-26" class="internal">The Thonny Python IDE</a></li>
<li><a href="section-27.html" data-scroll="section-27" class="internal">Debugging with Python</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">7</span> <span class="title">Python Basics</span></a><ul>
<li><a href="section-28.html" data-scroll="section-28" class="internal">Associated Reading</a></li>
<li><a href="section-29.html" data-scroll="section-29" class="internal">Basic Python Programs</a></li>
<li><a href="section-30.html" data-scroll="section-30" class="internal">Data Types</a></li>
<li><a href="section-31.html" data-scroll="section-31" class="internal">Checking User Input</a></li>
<li><a href="section-32.html" data-scroll="section-32" class="internal">Providing Output</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">8</span> <span class="title">Interfacing Basics</span></a><ul>
<li><a href="section-33.html" data-scroll="section-33" class="internal">Associated Reading</a></li>
<li><a href="section-34.html" data-scroll="section-34" class="internal">Connecting the Pi to Peripherials</a></li>
<li><a href="section-35.html" data-scroll="section-35" class="internal">Troubleshooting</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">9</span> <span class="title">Interfacing with increased versatility, and complexity.</span></a><ul>
<li><a href="section-36.html" data-scroll="section-36" class="internal">Associated Reading</a></li>
<li><a href="section-37.html" data-scroll="section-37" class="internal">Connecting Using Data Exchange Protocols</a></li>
<li><a href="section-38.html" data-scroll="section-38" class="internal">Reading and Using Data</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">10</span> <span class="title">Data Management</span></a><ul>
<li><a href="section-39.html" data-scroll="section-39" class="internal">Associated Reading</a></li>
<li><a href="section-40.html" data-scroll="section-40" class="internal">Connecting to the Internet</a></li>
</ul>
</li>
<li class="link backmatter"><a href="backmatter.html" data-scroll="backmatter" class="internal"><span class="title">Backmatter</span></a></li>
<li class="link">
<a href="appendix-1.html" data-scroll="appendix-1" class="internal"><span class="codenumber">A</span> <span class="title">References</span></a><ul><li><a href="references-section.html" data-scroll="references-section" class="internal">References</a></li></ul>
</li>
<li class="link">
<a href="appendix-2.html" data-scroll="appendix-2" class="internal"><span class="codenumber">B</span> <span class="title">Sourcing Suggestions</span></a><ul>
<li><a href="section-41.html" data-scroll="section-41" class="internal">Raspberry Pi</a></li>
<li><a href="section-42.html" data-scroll="section-42" class="internal">Sensors and Misc Components</a></li>
</ul>
</li>
<li class="link">
<a href="appendix-3.html" data-scroll="appendix-3" class="internal"><span class="codenumber">C</span> <span class="title">Using Pretext</span></a><ul>
<li><a href="section-43.html" data-scroll="section-43" class="internal">Editing and Building Custom Versions</a></li>
<li><a href="section-44.html" data-scroll="section-44" class="internal">Using PreTeXt CLI</a></li>
</ul>
</li>
<li class="link"><a href="colophon-2.html" data-scroll="colophon-2" class="internal"><span class="title">Colophon</span></a></li>
</ul></nav><div class="extras"><nav><a class="pretext-link" href="https://pretextbook.org">Authored in PreTeXt</a><a href="https://www.mathjax.org"><img title="Powered by MathJax" src="https://www.mathjax.org/badge/badge.gif" alt="Powered by MathJax"></a></nav></div>
</div></div>
<main class="main"><div id="content" class="pretext-content">
<section class="section" id="section-15"><h2 class="heading hide-type">
<span class="type">Section</span> <span class="codenumber">4.2</span> <span class="title">Loops</span>
</h2>
<p id="p-135">As you'll have learned from the reading branching, and control structures are closely related. The reality is that looping, as well as if, then, and else statements are entirely dependent upon decisions made based upon evaluations of values in our input.</p>
<section class="subsection" id="subsection-39"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">4.2.1</span> <span class="title">Discussion</span>
</h3>
<p id="p-136">Loops are incredibly useful. Mostly because they allow us to re-use portions of code so that we aren't typing out millions of lines of instructions to handle the same process over and over again, but also because they can seriously simplify processes that would require repeated decision making, thus simplifying our code, and making it more human readable.</p>
<p id="p-137">There are a couple of different approaches to loops, which you use may depend on the application.</p>
<p id="p-138">The first, which will be the subject of our first project in this experiment, uses an index, and decrements that index as you iterate over the elements of the array. Once the index reaches a specific value, the loop exits. This method is generally most useful when you know exactly how much data you're working with. Either through a calculation, or through some predefined method.</p>
<p id="p-139">The second looks for a specific value in the array, and when it is found, exits the loop. This approach is generally used for streams of data, or data with an undefined length.</p></section><section class="subsection" id="subsection-40"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">4.2.2</span> <span class="title">Code</span>
</h3>
<article class="project project-like" id="project-7"><h4 class="heading">
<span class="type">Project</span><span class="space"> </span><span class="codenumber">7</span><span class="period">.</span>
</h4>
<p id="p-140">Transcribe, compile, and run the program.</p>
<p id="p-141"><a class="external" href="https://github.com/ajbradburn/IntroToEmbeddedSystemsLabExercises/raw/master/assembly_control_structures/p1.s" target="_blank">Download the Source</a><a href="" data-knowl="" class="id-ref fn-knowl original" data-refid="hk-fn-21" id="fn-21"><sup> 21 </sup></a></p>
<figure class="listing figure-like" id="listing-12"><div class="code-box" style="width: 100%; margin-left: 0%; margin-right: 0%;"><pre class="program"><code class="language-none"> 1|  .data
 2|  .balign 4
 3|  numbers: .word 10, 9, 8, 7, 6, 5, 4, 3, 2, 1
 4|  .balign 4
 5|  number_count: .word 10
 6|
 7|  .text
 8|  .balign 4
 9|  .global main
10|  .func main
11|
12|  main:
13|    mov r0, #5
14|    mov r1, #5
15|      /* r0 + 5 */
16|    add r0, r0, r1
17|
18|      /* Create an itteration counter that starts with the number count */
19|    ldr r3, =number_count
20|    ldr r3, [r3]
21|
22|    ldr r2, =numbers
23|  add_more:
24|    ldr r1, [r2], #4
25|    add r0, r0, r1
26|      /* Decriment our itteration counter. */
27|    sub r3, r3, #1
28|      /* Is our itteration counter equal to 0? */
29|    cmp r3, #0
30|      /* If yes/true, jump to the end of the program. */
31|    beq end
32|
33|      /* If no/false, do it again. */
34|    b add_more
35|  end:
36|
37|    bx lr
</code></pre></div>
<figcaption><span class="type">Listing</span><span class="space"> </span><span class="codenumber">4.2.1<span class="period">.</span></span><span class="space"> </span></figcaption></figure></article></section><section class="subsection" id="subsection-41"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">4.2.3</span> <span class="title">Exploration</span>
</h3>
<p id="p-142">In this example, we define an index value <code class="code-inline tex2jax_ignore">number_count</code> on line 5 and load it into register <code class="code-inline tex2jax_ignore">r3</code> on lines 19 and 20. Then, as we load, and add each element of the <code class="code-inline tex2jax_ignore">numbers</code> array, we decrement <code class="code-inline tex2jax_ignore">r3</code> by 1 on line 27. Next, we compare the value in <code class="code-inline tex2jax_ignore">r3</code> to 0 to set flags. The <code class="code-inline tex2jax_ignore">beq</code> command on line 31 will check the flags to see if <code class="code-inline tex2jax_ignore">r3</code> and 0 are equal, if so, it will jump to the <code class="code-inline tex2jax_ignore">end:</code> label. If not, it will advance to the <code class="code-inline tex2jax_ignore">b add_more</code> instruction on line 34, which sends our program back to the <code class="code-inline tex2jax_ignore">add_more:</code> label on line 23.</p>
<figure class="figure figure-like" id="figure-29"><div class="image-box" style="width: 25%; margin-left: 37.5%; margin-right: 37.5%;"><img src="external/generated/assembly_control_structures_img02.svg" role="img" class="contained" alt="The logical flow of our application as described."></div>
<figcaption><span class="type">Figure</span><span class="space"> </span><span class="codenumber">4.2.2<span class="period">.</span></span><span class="space"> </span>The logical flow of the program.</figcaption></figure><article class="exercise exercise-like" id="exercise-12"><a href="" data-knowl="" class="id-ref exercise-knowl original" data-refid="hk-exercise-12"><h4 class="heading">
<span class="type">Checkpoint</span><span class="space"> </span><span class="codenumber">4.2.3</span><span class="period">.</span>
</h4></a></article><div class="hidden-content tex2jax_ignore" id="hk-exercise-12"><article class="exercise exercise-like">What is the value returned by the program?<div class="solutions">
<a href="" data-knowl="" class="id-ref answer-knowl original" data-refid="hk-answer-9" id="answer-9"><span class="type">Answer</span><span class="period">.</span></a><div class="hidden-content tex2jax_ignore" id="hk-answer-9"><div class="answer solution-like">65</div></div>
</div></article></div>
<article class="exercise exercise-like" id="exercise-13"><a href="" data-knowl="" class="id-ref exercise-knowl original" data-refid="hk-exercise-13"><h4 class="heading">
<span class="type">Checkpoint</span><span class="space"> </span><span class="codenumber">4.2.4</span><span class="period">.</span>
</h4></a></article><div class="hidden-content tex2jax_ignore" id="hk-exercise-13"><article class="exercise exercise-like">What would happen if the index were initialized at 11, or 0 instead of 10?<div class="solutions">
<a href="" data-knowl="" class="id-ref answer-knowl original" data-refid="hk-answer-10" id="answer-10"><span class="type">Answer</span><span class="period">.</span></a><div class="hidden-content tex2jax_ignore" id="hk-answer-10"><div class="answer solution-like">?</div></div>
</div></article></div></section><section class="subsection" id="subsection-42"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">4.2.4</span> <span class="title">Discussion</span>
</h3>
<p id="p-143">Our next program illustrates the process of looking for a special value in an array, and exiting the loop when it is found.</p>
<figure class="figure figure-like" id="figure-30"><div class="image-box" style="width: 35%; margin-left: 32.5%; margin-right: 32.5%;"><img src="external/generated/assembly_control_structures_img03.svg" role="img" class="contained" alt="The logical flow of our application as described."></div>
<figcaption><span class="type">Figure</span><span class="space"> </span><span class="codenumber">4.2.5<span class="period">.</span></span><span class="space"> </span>The logical flow of the program.</figcaption></figure></section><section class="subsection" id="subsection-43"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">4.2.5</span> <span class="title">Code</span>
</h3>
<article class="project project-like" id="project-8"><h4 class="heading">
<span class="type">Project</span><span class="space"> </span><span class="codenumber">8</span><span class="period">.</span>
</h4>
<p id="p-144">Transcribe, compile, and run the program.</p>
<p id="p-145"><a class="external" href="https://github.com/ajbradburn/IntroToEmbeddedSystemsLabExercises/raw/master/assembly_control_structures/p2.s" target="_blank">Download the Source</a><a href="" data-knowl="" class="id-ref fn-knowl original" data-refid="hk-fn-22" id="fn-22"><sup> 22 </sup></a></p>
<figure class="listing figure-like" id="listing-13"><div class="code-box" style="width: 100%; margin-left: 0%; margin-right: 0%;"><pre class="program"><code class="language-none"> 1|  .data
 2|  .balign 4
 3|  numbers: .word 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0
 4|
 5|  .text
 6|  .balign 4
 7|  .global main
 8|  .func main
 9|
10|  main:
11|    mov r0, #5
12|    mov r1, #5
13|      /* r0 + 5 */
14|    add r0, r0, r1
15|
16|    ldr r2, =numbers
17|  add_more:
18|    ldr r1, [r2], #4
19|      /* Is the new number equal to 0? */
20|    cmp r1, #0
21|    beq end
22|      /* Add new number. */
23|    add r0, r0, r1
24|      /* Do it again. */
25|    b add_more
26|  end:
27|
28|    bx lr
</code></pre></div>
<figcaption><span class="type">Listing</span><span class="space"> </span><span class="codenumber">4.2.6<span class="period">.</span></span><span class="space"> </span></figcaption></figure></article></section><section class="subsection" id="subsection-44"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">4.2.6</span> <span class="title">Exploration</span>
</h3>
<p id="p-146">In this example, we simply add a special character (0) at the end of our numbers array, and as we load each number, we check to see if the newly loaded value is equal to our special character. On line 20, we compare <code class="code-inline tex2jax_ignore">r1</code> and 0 to set flags. Then on line 21 the <code class="code-inline tex2jax_ignore">beq end</code> instruction checks the flags, and if <code class="code-inline tex2jax_ignore">r1</code> is equal to our special character, we jump to the <code class="code-inline tex2jax_ignore">end:</code> label on line 26. Otherwise, the program advances, adds the new value to our running total in <code class="code-inline tex2jax_ignore">r0</code> and then reaches <code class="code-inline tex2jax_ignore">b add_more</code> on line 25 which sends the program back to the <code class="code-inline tex2jax_ignore">add_more</code> label on line 17.</p></section></section><div class="hidden-content tex2jax_ignore" id="hk-fn-21"><div class="fn"><code class="code-inline tex2jax_ignore">https://github.com/ajbradburn/IntroToEmbeddedSystemsLabExercises/raw/master/assembly_control_structures/p1.s</code></div></div>
<div class="hidden-content tex2jax_ignore" id="hk-fn-22"><div class="fn"><code class="code-inline tex2jax_ignore">https://github.com/ajbradburn/IntroToEmbeddedSystemsLabExercises/raw/master/assembly_control_structures/p2.s</code></div></div>
</div></main>
</div>
<script src="https://unpkg.com/prismjs@v1.22.0/components/prism-core.min.js"></script><script src="https://unpkg.com/prismjs@v1.22.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>

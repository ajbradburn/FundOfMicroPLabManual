<!DOCTYPE html>
<!--********************************************-->
<!--*       Generated from PreTeXt source      *-->
<!--*       on 2022-04-12T09:19:02-04:00       *-->
<!--*   A recent stable commit (2020-08-09):   *-->
<!--* 98f21740783f166a773df4dc83cab5293ab63a4a *-->
<!--*                                          *-->
<!--*         https://pretextbook.org          *-->
<!--*                                          *-->
<!--********************************************-->
<html lang="en-US">
<head xmlns:og="http://ogp.me/ns#" xmlns:book="https://ogp.me/ns/book#">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Branching</title>
<meta name="Keywords" content="Authored in PreTeXt">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:type" content="book">
<meta property="book:title" content="An Introduction to Embedded Systems and Applications">
<meta property="book:author" content="Anthony Bradburn">
<script>window.MathJax = {
  tex: {
    inlineMath: [['\\(','\\)']],
    tags: "none",
    useLabelIds: true,
    tagSide: "right",
    tagIndent: ".8em",
    packages: {'[+]': ['base', 'extpfeil', 'ams', 'amscd', 'newcommand', 'knowl']}
  },
  options: {
    ignoreHtmlClass: "tex2jax_ignore|ignore-math",
    processHtmlClass: "process-math",
  },
  chtml: {
    scale: 0.88,
    mtextInheritFont: true
  },
  loader: {
    load: ['input/asciimath', '[tex]/extpfeil', '[tex]/amscd', '[tex]/newcommand', '[pretext]/mathjaxknowl3.js'],
    paths: {pretext: "https://pretextbook.org/js/lib"},
  },
};
</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><link href="https://unpkg.com/prismjs@v1.22.0/themes/prism.css" rel="stylesheet">
<script src="https://pretextbook.org/js/lib/jquery.min.js"></script><script src="https://pretextbook.org/js/lib/jquery.sticky.js"></script><script src="https://pretextbook.org/js/lib/jquery.espy.min.js"></script><script src="https://pretextbook.org/js/0.13/pretext.js"></script><script>miniversion=0.674</script><script src="https://pretextbook.org/js/0.13/pretext_add_on.js?x=1"></script><script src="https://pretextbook.org/js/lib/knowl.js"></script><!--knowl.js code controls Sage Cells within knowls--><script>sagecellEvalName='Evaluate (Sage)';
</script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600,600italic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/pretext.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/pretext_add_on.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/banner_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/toc_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/knowls_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/style_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/colors_blue_red.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.4/setcolors.css" rel="stylesheet" type="text/css">
<!-- 2019-10-12: Temporary - CSS file for experiments with styling --><link href="developer.css" rel="stylesheet" type="text/css">
</head>
<body class="pretext-book ignore-math has-toc has-sidebar-left">
<a class="assistive" href="#content">Skip to main content</a><div id="latex-macros" class="hidden-content process-math" style="display:none"><span class="process-math">\(\newcommand{\N}{\mathbb N}
\newcommand{\Z}{\mathbb Z}
\newcommand{\Q}{\mathbb Q}
\newcommand{\R}{\mathbb R}
\newcommand{\lt}{&lt;}
\newcommand{\gt}{&gt;}
\newcommand{\amp}{&amp;}
\)</span></div>
<header id="masthead" class="smallbuttons"><div class="banner"><div class="container">
<a id="logo-link" href=""></a><div class="title-container">
<h1 class="heading"><a href="my-great-book.html"><span class="title">An Introduction to Embedded Systems and Applications:</span> <span class="subtitle">Through the Raspberry Pi</span></a></h1>
<p class="byline">Anthony Bradburn</p>
</div>
</div></div>
<nav id="primary-navbar" class="navbar"><div class="container">
<div class="navbar-top-buttons">
<button class="sidebar-left-toggle-button button active" aria-label="Show or hide table of contents sidebar">Contents</button><div class="tree-nav toolbar toolbar-divisor-3"><span class="threebuttons"><a id="previousbutton" class="previous-button toolbar-item button" href="section-15.html" title="Previous">Prev</a><a id="upbutton" class="up-button button toolbar-item" href="ch-first.html" title="Up">Up</a><a id="nextbutton" class="next-button button toolbar-item" href="ch-first.html" title="Next">Next</a></span></div>
</div>
<div class="navbar-bottom-buttons toolbar toolbar-divisor-4">
<button class="sidebar-left-toggle-button button toolbar-item active">Contents</button><a class="previous-button toolbar-item button" href="section-15.html" title="Previous">Prev</a><a class="up-button button toolbar-item" href="ch-first.html" title="Up">Up</a><a class="next-button button toolbar-item" href="ch-first.html" title="Next">Next</a>
</div>
</div></nav></header><div class="page">
<div id="sidebar-left" class="sidebar" role="navigation"><div class="sidebar-content">
<nav id="toc"><ul>
<li class="link frontmatter">
<a href="frontmatter.html" data-scroll="frontmatter" class="internal"><span class="title">Front Matter</span></a><ul>
<li><a href="colophon-1.html" data-scroll="colophon-1" class="internal">Colophon</a></li>
<li><a href="preface.html" data-scroll="preface" class="internal">Feedback about the text</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">1</span> <span class="title">Setting up for, and exploring assembly programming.</span></a><ul>
<li><a href="section-1.html" data-scroll="section-1" class="internal">Installing Code::Blocks IDE in Raspberry Pi OS</a></li>
<li><a href="section-2.html" data-scroll="section-2" class="internal">Writing and Debugging Programs</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">2</span> <span class="title">Basics of Programming</span></a><ul>
<li><a href="section-3.html" data-scroll="section-3" class="internal">Where to begin?</a></li>
<li><a href="section-4.html" data-scroll="section-4" class="internal">Defining the problem.</a></li>
<li><a href="section-5.html" data-scroll="section-5" class="internal">Framing the Solution.</a></li>
<li><a href="section-6.html" data-scroll="section-6" class="internal">Documenting the process.</a></li>
<li><a href="section-7.html" data-scroll="section-7" class="internal">Writing Code</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">3</span> <span class="title">Basics of Assembly</span></a><ul>
<li><a href="section-8.html" data-scroll="section-8" class="internal">Associated Reading</a></li>
<li><a href="section-9.html" data-scroll="section-9" class="internal">Basic Operations and Composition</a></li>
<li><a href="section-10.html" data-scroll="section-10" class="internal">Memory Addressing</a></li>
<li><a href="section-11.html" data-scroll="section-11" class="internal">Arithmetic Functions</a></li>
<li><a href="section-12.html" data-scroll="section-12" class="internal">Logical Operations</a></li>
<li><a href="section-13.html" data-scroll="section-13" class="internal">C</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">4</span> <span class="title">Assembly Control Structures</span></a><ul>
<li><a href="section-14.html" data-scroll="section-14" class="internal">Associated Reading</a></li>
<li><a href="section-15.html" data-scroll="section-15" class="internal">Loops</a></li>
<li><a href="section-16.html" data-scroll="section-16" class="active">Branching</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">5</span> <span class="title">High-level Programming Languages</span></a><ul>
<li><a href="section-17.html" data-scroll="section-17" class="internal">Associated Reading</a></li>
<li><a href="section-18.html" data-scroll="section-18" class="internal">High Level Programming Languages</a></li>
<li><a href="section-19.html" data-scroll="section-19" class="internal">Libraries</a></li>
<li><a href="section-20.html" data-scroll="section-20" class="internal">Functions</a></li>
<li><a href="section-21.html" data-scroll="section-21" class="internal">Variables</a></li>
<li><a href="section-22.html" data-scroll="section-22" class="internal">Control Structures</a></li>
<li><a href="section-23.html" data-scroll="section-23" class="internal">Structure</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">6</span> <span class="title">Setting up for, and exploring python programming.</span></a><ul>
<li><a href="section-24.html" data-scroll="section-24" class="internal">Raspi Config</a></li>
<li><a href="section-25.html" data-scroll="section-25" class="internal">Installing Python Libraries</a></li>
<li><a href="section-26.html" data-scroll="section-26" class="internal">The Thonny Python IDE</a></li>
<li><a href="section-27.html" data-scroll="section-27" class="internal">Debugging with Python</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">7</span> <span class="title">Python Basics</span></a><ul>
<li><a href="section-28.html" data-scroll="section-28" class="internal">Associated Reading</a></li>
<li><a href="section-29.html" data-scroll="section-29" class="internal">Basic Python Programs</a></li>
<li><a href="section-30.html" data-scroll="section-30" class="internal">Data Types</a></li>
<li><a href="section-31.html" data-scroll="section-31" class="internal">Checking User Input</a></li>
<li><a href="section-32.html" data-scroll="section-32" class="internal">Providing Output</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">8</span> <span class="title">Interfacing Basics</span></a><ul>
<li><a href="section-33.html" data-scroll="section-33" class="internal">Associated Reading</a></li>
<li><a href="section-34.html" data-scroll="section-34" class="internal">Connecting the Pi to Peripherials</a></li>
<li><a href="section-35.html" data-scroll="section-35" class="internal">Troubleshooting</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">9</span> <span class="title">Interfacing with increased versatility, and complexity.</span></a><ul>
<li><a href="section-36.html" data-scroll="section-36" class="internal">Associated Reading</a></li>
<li><a href="section-37.html" data-scroll="section-37" class="internal">Connecting Using Data Exchange Protocols</a></li>
<li><a href="section-38.html" data-scroll="section-38" class="internal">Reading and Using Data</a></li>
</ul>
</li>
<li class="link">
<a href="ch-first.html" data-scroll="ch-first" class="internal"><span class="codenumber">10</span> <span class="title">Data Management</span></a><ul>
<li><a href="section-39.html" data-scroll="section-39" class="internal">Associated Reading</a></li>
<li><a href="section-40.html" data-scroll="section-40" class="internal">Connecting to the Internet</a></li>
</ul>
</li>
<li class="link backmatter"><a href="backmatter.html" data-scroll="backmatter" class="internal"><span class="title">Backmatter</span></a></li>
<li class="link">
<a href="appendix-1.html" data-scroll="appendix-1" class="internal"><span class="codenumber">A</span> <span class="title">References</span></a><ul><li><a href="references-section.html" data-scroll="references-section" class="internal">References</a></li></ul>
</li>
<li class="link">
<a href="appendix-2.html" data-scroll="appendix-2" class="internal"><span class="codenumber">B</span> <span class="title">Sourcing Suggestions</span></a><ul>
<li><a href="section-41.html" data-scroll="section-41" class="internal">Raspberry Pi</a></li>
<li><a href="section-42.html" data-scroll="section-42" class="internal">Sensors and Misc Components</a></li>
</ul>
</li>
<li class="link">
<a href="appendix-3.html" data-scroll="appendix-3" class="internal"><span class="codenumber">C</span> <span class="title">Using Pretext</span></a><ul>
<li><a href="section-43.html" data-scroll="section-43" class="internal">Editing and Building Custom Versions</a></li>
<li><a href="section-44.html" data-scroll="section-44" class="internal">Using PreTeXt CLI</a></li>
</ul>
</li>
<li class="link"><a href="colophon-2.html" data-scroll="colophon-2" class="internal"><span class="title">Colophon</span></a></li>
</ul></nav><div class="extras"><nav><a class="pretext-link" href="https://pretextbook.org">Authored in PreTeXt</a><a href="https://www.mathjax.org"><img title="Powered by MathJax" src="https://www.mathjax.org/badge/badge.gif" alt="Powered by MathJax"></a></nav></div>
</div></div>
<main class="main"><div id="content" class="pretext-content">
<section class="section" id="section-16"><h2 class="heading hide-type">
<span class="type">Section</span> <span class="codenumber">4.3</span> <span class="title">Branching</span>
</h2>
<section class="subsection" id="subsection-45"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">4.3.1</span> <span class="title">Discussion</span>
</h3>
<p id="p-147">As we continue with our exploration of control structures in assembly, we are going to shift our frame of reference a bit, and use a different example.</p>
<p id="p-148">Let us imagine that we have a project that needs to control the temperature of an enclosure. We have a temperature sensor, two relays, and an alarm buzzer attached to a microcontroller.</p>
<p id="p-149">One of the relays enables power for a heating element. The other enables power for an air conditioning unit.</p>
<p id="p-150">Our objective is to write a program for our little micro controller that takes a temperature reading from the sensor, and turns on the heat, the air conditioner, or does nothing, depending on defined conditions.</p>
<p id="p-151">Our design takes into consideration that something may go wrong with our temperature control equipment, and so it is important that we include functionality that will alert us in the event that there is some sort of failure.</p>
<p id="p-152">Our failure condition is: if we go to enable either the heater, or air conditioner, and it is already enabled. In either case, we may have a broken sensor, a broken temperature control circuit, or a compromised enclosure.</p>
<p id="p-153">The logic looks a bit like this:</p>
<figure class="figure figure-like" id="figure-31"><div class="image-box" style="width: 75%; margin-left: 12.5%; margin-right: 12.5%;"><img src="external/generated/assembly_control_structures_img04.svg" role="img" class="contained" alt="The logical flow of our application as described."></div>
<figcaption><span class="type">Figure</span><span class="space"> </span><span class="codenumber">4.3.1<span class="period">.</span></span><span class="space"> </span>The logical flow of the program.</figcaption></figure></section><section class="subsection" id="subsection-46"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">4.3.2</span> <span class="title">Code</span>
</h3>
<article class="project project-like" id="project-9"><h4 class="heading">
<span class="type">Project</span><span class="space"> </span><span class="codenumber">9</span><span class="period">.</span>
</h4>
<p id="p-154">Transcribe, compile, and run the program.</p>
<p id="p-155"><a class="external" href="https://github.com/ajbradburn/IntroToEmbeddedSystemsLabExercises/raw/master/assembly_control_structures/p3.s" target="_blank">Download the Source</a><a href="" data-knowl="" class="id-ref fn-knowl original" data-refid="hk-fn-23" id="fn-23"><sup> 23 </sup></a></p>
<figure class="listing figure-like" id="listing-14"><div class="code-box" style="width: 100%; margin-left: 0%; margin-right: 0%;"><pre class="program"><code class="language-none"> 1|  .data
 2|  temp_measurement: .word 130
 3|  temp_upper: .word 150
 4|  temp_lower: .word  100
 5|
 6|  .text
 7|
 8|  error:
 9|    /* Send a signal to a connected monitoring device. */
10|    /* Turn on a red LED. */
11|    mov r0, #0
12|    b end
13|
14|  all_off:
15|    and r3, r7, #6
16|    eor r7, r7, r7
17|    mov r0, #1
18|    b end
19|
20|  cool_on:
21|    /* Check if cool is already enabled. */
22|    and r3, r7, #2
23|    cmp r3, #2
24|    /* If yes, go to error. */
25|    beq error
26|    /* if no, enable. */
27|    and r7, r7, #2
28|    mov r0, #2
29|    b end
30|
31|  heat_on:
32|    /* Check if heat is already enabled. */
33|    and r3, r7, #4
34|    cmp r3, #4
35|    /* If yes, go to error. */
36|    beq error
37|    /* if no, enable. */
38|    and r7, r7, #4
39|    mov r0, #3
40|    b end
41|
</code></pre></div>
<figcaption><span class="type">Listing</span><span class="space"> </span><span class="codenumber">4.3.2<span class="period">.</span></span><span class="space"> </span></figcaption></figure><figure class="listing figure-like" id="listing-15"><div class="code-box" style="width: 100%; margin-left: 0%; margin-right: 0%;"><pre class="program"><code class="language-none">42|  .global main
43|  main:
44|    /* Check temperature reading. */
45|    ldr r1, =temp_measurement
46|    ldr r1, [r1]
47|
48|    /* If equal or above temp_upper, call cool. */
49|    ldr r2, =temp_upper
50|    ldr r2, [r2]
51|    /* cmp subtracts r1 from r2 */
52|    cmp r1, r2
53|    bhs cool_on
54|
55|    /* If equal or lower temp_lower, call heat. */
56|    ldr r2, =temp_lower
57|    ldr r2, [r2]
58|    cmp r1, r2
59|    bls heat_on
60|
61|    /* If neither, continue. */
62|    b all_off
63|  end:
64|    bx lr
</code></pre></div>
<figcaption><span class="type">Listing</span><span class="space"> </span><span class="codenumber">4.3.3<span class="period">.</span></span><span class="space"> </span></figcaption></figure></article></section><section class="subsection" id="subsection-47"><h3 class="heading hide-type">
<span class="type">Subsection</span> <span class="codenumber">4.3.3</span> <span class="title">Exploration</span>
</h3>
<article class="exercise exercise-like" id="exercise-14"><a href="" data-knowl="" class="id-ref exercise-knowl original" data-refid="hk-exercise-14"><h4 class="heading">
<span class="type">Checkpoint</span><span class="space"> </span><span class="codenumber">4.3.4</span><span class="period">.</span>
</h4></a></article><div class="hidden-content tex2jax_ignore" id="hk-exercise-14"><article class="exercise exercise-like">What is the return value for the program as it is written?<div class="solutions">
<a href="" data-knowl="" class="id-ref answer-knowl original" data-refid="hk-answer-11" id="answer-11"><span class="type">Answer</span><span class="period">.</span></a><div class="hidden-content tex2jax_ignore" id="hk-answer-11"><div class="answer solution-like">?</div></div>
</div></article></div>
<article class="exercise exercise-like" id="exercise-15"><a href="" data-knowl="" class="id-ref exercise-knowl original" data-refid="hk-exercise-15"><h4 class="heading">
<span class="type">Checkpoint</span><span class="space"> </span><span class="codenumber">4.3.5</span><span class="period">.</span>
</h4></a></article><div class="hidden-content tex2jax_ignore" id="hk-exercise-15"><article class="exercise exercise-like">What is the return value if you change the <code class="code-inline tex2jax_ignore">temp_measurement</code> definition to 151?<div class="solutions">
<a href="" data-knowl="" class="id-ref answer-knowl original" data-refid="hk-answer-12" id="answer-12"><span class="type">Answer</span><span class="period">.</span></a><div class="hidden-content tex2jax_ignore" id="hk-answer-12"><div class="answer solution-like">?</div></div>
</div></article></div>
<article class="exercise exercise-like" id="exercise-16"><a href="" data-knowl="" class="id-ref exercise-knowl original" data-refid="hk-exercise-16"><h4 class="heading">
<span class="type">Checkpoint</span><span class="space"> </span><span class="codenumber">4.3.6</span><span class="period">.</span>
</h4></a></article><div class="hidden-content tex2jax_ignore" id="hk-exercise-16"><article class="exercise exercise-like">What is the return value if you change the <code class="code-inline tex2jax_ignore">temp_measurement</code> definition to 99?<div class="solutions">
<a href="" data-knowl="" class="id-ref answer-knowl original" data-refid="hk-answer-13" id="answer-13"><span class="type">Answer</span><span class="period">.</span></a><div class="hidden-content tex2jax_ignore" id="hk-answer-13"><div class="answer solution-like">?</div></div>
</div></article></div>
<article class="exercise exercise-like" id="exercise-17"><a href="" data-knowl="" class="id-ref exercise-knowl original" data-refid="hk-exercise-17"><h4 class="heading">
<span class="type">Checkpoint</span><span class="space"> </span><span class="codenumber">4.3.7</span><span class="period">.</span>
</h4></a></article><div class="hidden-content tex2jax_ignore" id="hk-exercise-17"><article class="exercise exercise-like">What is the return value of the program if you insert <code class="code-inline tex2jax_ignore">mov r7, #2</code> between lines 43, and 44, and change the <code class="code-inline tex2jax_ignore">temp_measurement</code> definition to 200?<div class="solutions">
<a href="" data-knowl="" class="id-ref answer-knowl original" data-refid="hk-answer-14" id="answer-14"><span class="type">Answer</span><span class="period">.</span></a><div class="hidden-content tex2jax_ignore" id="hk-answer-14"><div class="answer solution-like">?</div></div>
</div></article></div></section></section><div class="hidden-content tex2jax_ignore" id="hk-fn-23"><div class="fn"><code class="code-inline tex2jax_ignore">https://github.com/ajbradburn/IntroToEmbeddedSystemsLabExercises/raw/master/assembly_control_structures/p3.s</code></div></div>
</div></main>
</div>
<script src="https://unpkg.com/prismjs@v1.22.0/components/prism-core.min.js"></script><script src="https://unpkg.com/prismjs@v1.22.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
